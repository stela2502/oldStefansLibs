#! /usr/bin/perl
use strict;
use warnings;
use Test::More tests => 4;
BEGIN { use_ok 'stefans_libs::file_readers::stat_results::Spearman_result' }

my ( $test_object, $value, $exp, @values, $temp_sav );
$test_object = stefans_libs::file_readers::stat_results::Spearman_result->new();
is_deeply(
	ref($test_object),
	'stefans_libs::file_readers::stat_results::Spearman_result',
'simple test of function stefans_libs::file_readers::stat_results::Spearman_result -> new()'
);

my $test_file = 't/data/Spearman_results.xls';
$test_file = 'data/Spearman_results.xls' unless ( -f $test_file );
Carp::confess("Oops - I could not find the test data file #1 -> $test_file")
  unless ( -f $test_file );

$test_object->read_file($test_file);

$exp = [
	'correlating data set', '',     '',     '',
	'',                     '24.7', '24.7', '23.9',
	'27.7',                 '17.6', '28.4', '21.1',
	'27',                   '29',   '26.1', '26.1',
	'29.4',                 '26.8', '26.2', '28.4',
	'26',                   '24.7', '23.9', '22.5',
	'26.2',                 '29.1', '21.1', '22',
	'27.5',                 '24.2', '36.6', '26.3',
	'26.2',                 '26.3', '29.4', '24.5',
	'27.8',                 '28.4', '26.1', '26.2',
	'27',                   '24.8', '24.5', '22.5',
	'23.1',                 '22.9', '21.5', '23.4',
	'23.5',                 '27.5', '24.8', '33.1',
	'34.6',                 '25.7', '23.7', '24.7',
	'24.6',                 '27',   '19.4', '26',
	'33.6',                 '24.7', '36.9', '32.5',
	'25.3',                 '28.7', '34.2', '25.7',
	'23.9',                 '33.4', '24.8', '24.9',
	'26.3',                 '23.2', '22.5', '24.9',
	'30.5',                 '24.5', '24.2', '31.1',
	'26'
];
is_deeply( $test_object->{'x_values'}, $exp, "correlating data" );

$exp = [
	'7917645',       'RN28S1',        '0.03226',       '55162.1',
	'0.2459043',     '13.9277391791', '14.0020618744', '13.8545247709',
	'14.0099740804', '14.0020618744', '13.9865747671', '13.9715887983',
	'14.0399074689', '14.0703805449', '14.0199968505', '14.0020618744',
	'14.0020618744', '14.0020618744', '13.9978889326', '14.0225218176',
	'13.9694975088', '14.0322651067', '13.9768025663', '14.0020618744',
	'13.9978889326', '14.0071658618', '13.9716258556', '13.9626123724',
	'14.0045468124', '13.9803724923', '13.9682161498', '14.012571975',
	'13.9701927909', '13.919452415',  '13.9902062815', '13.8850786271',
	'13.989939435',  '14.0322467051', '14.011983245',  '13.9978701863',
	'13.9876445569', '13.9837289578', '13.990038988',  '13.9527234223',
	'14.1017884967', '13.9202436685', '14.069289963',  '13.9811842879',
	'13.9510426256', '14.0156922657', '14.0133917339', '13.9602259731',
	'13.9995844095', '13.9663049839', '14.0087839743', '14.0402349865',
	'14.0061735978', '13.9982389732', '13.9549550209', '14.0270796088',
	'13.9995844095', '13.8875567093', '13.9999178938', '14.0446507776',
	'14.0120268209', '14.0188000005', '13.9619466901', '13.9814037696',
	'14.0228537956', '14.0514308661', '14.0523644183', '13.9358605599',
	'13.9740843366', '13.9474089465', '13.9650427105', '13.9998521064',
	'14.0635584008', '14.002540391',  '14.020096359',  '13.9998348184',
	'13.9603317295'
];

is_deeply( @{ $test_object->{'data'} }[0], $exp, "first data-set" );

$temp_sav = $test_object->{'data'};
$test_object->{'data'} = [$exp];

is_deeply ( $test_object->AsString(), &get_string(), 'data prints right');
is_deeply ( $test_object->GeneNames(), ['RN28S1'], 'we get the right gene names');

unlink ('/home/stefan/temp/simply_removeable/Spearman_results_7917645_RN28S1.svg') if ( -f '/home/stefan/temp/simply_removeable/Spearman_results_7917645_RN28S1.svg');
$test_object->plot( '/home/stefan/temp/simply_removeable/' );
is_deeply ( -f '/home/stefan/temp/simply_removeable/Spearman_results_7917645_RN28S1.svg', 1, 'we could plot a file' );
#print "\$exp = " . root->print_perl_var_def( @{$test_object->{'data'}}[0] ) . ";\n";

## A handy help if you do not know what you should expect
#print "\$exp = ".root->print_perl_var_def($value ).";\n";


sub get_string {
	return '#Probe Set ID	Gene Symbol	p-value	S	rho	ISL0001	ISL0002	ISL0003	ISL0004	ISL0005	ISL0006	ISL0007	ISL0008	ISL0009	ISL0010	ISL0011	ISL0012	ISL0013	ISL0014	ISL0015	ISL0016	ISL0019	ISL0020	ISL0021	ISL0022	ISL0023	ISL0024	ISL0025	ISL0026	ISL0027	ISL0028	ISL0029	ISL0030	ISL0031	ISL0032	ISL0033	ISL0034	ISL0035	ISL0036	ISL0037	ISL0038	ISL0039	ISL0040	ISL0041	ISL0042	ISL0043	ISL0044	ISL0046	ISL0047	ISL0048	ISL0049	ISL0050	ISL0051	ISL0052	ISL0053	ISL0054	ISL0055	ISL0056	ISL0057	ISL0058	ISL0059	ISL0060	ISL0061	ISL0062	ISL0063	ISL0064	ISL0065	ISL0066	ISL0067	ISL0068	ISL0069	ISL0070	ISL0071	ISL0072	ISL0073	ISL0074	ISL0076	ISL0077	ISL0078	ISL0079	ISL0080
correlating data set					24.7	24.7	23.9	27.7	17.6	28.4	21.1	27	29	26.1	26.1	29.4	26.8	26.2	28.4	26	24.7	23.9	22.5	26.2	29.1	21.1	22	27.5	24.2	36.6	26.3	26.2	26.3	29.4	24.5	27.8	28.4	26.1	26.2	27	24.8	24.5	22.5	23.1	22.9	21.5	23.4	23.5	27.5	24.8	33.1	34.6	25.7	23.7	24.7	24.6	27	19.4	26	33.6	24.7	36.9	32.5	25.3	28.7	34.2	25.7	23.9	33.4	24.8	24.9	26.3	23.2	22.5	24.9	30.5	24.5	24.2	31.1	26
7917645	RN28S1	0.03226	55162.1	0.2459043	13.9277391791	14.0020618744	13.8545247709	14.0099740804	14.0020618744	13.9865747671	13.9715887983	14.0399074689	14.0703805449	14.0199968505	14.0020618744	14.0020618744	14.0020618744	13.9978889326	14.0225218176	13.9694975088	14.0322651067	13.9768025663	14.0020618744	13.9978889326	14.0071658618	13.9716258556	13.9626123724	14.0045468124	13.9803724923	13.9682161498	14.012571975	13.9701927909	13.919452415	13.9902062815	13.8850786271	13.989939435	14.0322467051	14.011983245	13.9978701863	13.9876445569	13.9837289578	13.990038988	13.9527234223	14.1017884967	13.9202436685	14.069289963	13.9811842879	13.9510426256	14.0156922657	14.0133917339	13.9602259731	13.9995844095	13.9663049839	14.0087839743	14.0402349865	14.0061735978	13.9982389732	13.9549550209	14.0270796088	13.9995844095	13.8875567093	13.9999178938	14.0446507776	14.0120268209	14.0188000005	13.9619466901	13.9814037696	14.0228537956	14.0514308661	14.0523644183	13.9358605599	13.9740843366	13.9474089465	13.9650427105	13.9998521064	14.0635584008	14.002540391	14.020096359	13.9998348184	13.9603317295
'
}