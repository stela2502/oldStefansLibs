#! /usr/bin/perl
use strict;
use warnings;
use Test::More tests => 12;
BEGIN { use_ok 'stefans_libs::array_analysis::correlatingData' }
use stefans_libs::root;
## test for new

my $PID = 0;
$PID = fork();
if ( $PID < 0 ) {
	print "I can not create a child!\n";
	exit(-1);
}
if ( $PID > 0 ) {
	print "we have two processes: $$ and $PID!\n";
}

my $correlatingData = Wilcox_Test->new();
my ( $value, $rand1, $rand2 );
$value = 0;
my $start = root->time();
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [1.87524218872023, 1.68535172445166, 0.398962554132844, 0.940563882881079, 0.646858054004191, 1.65328009144284], [1.62012976016256, 1.57127036954095, 1.60424980240061, 0.397600097699524, 0.883304292368472, 1.54468578657084] ) ,"0.5752\t22\t",$$.' rand 0');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [0.339251709696306, 1.67033647575911, 1.32647406697014, 1.04436577874024, 1.13810715632429, 1.96703046117733], [0.398584241641309, 1.81592270653529, 1.9859107324335, 0.0498687211448612, 0.131340976410961, 0.567339159512173] ) ,"0.4712\t23\t",$$.' rand 1');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [1.45097478930297, 0.263665191476889, 1.34716470232544, 1.50978228337324, 0.845134173825137, 1.97401148435952], [1.17990126960614, 0.665159174214168, 1.3212998188185, 1.05787130706921, 0.301233880728908, 1.12446151575399] ) ,"0.2298\t26\t",$$.' rand 2');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [0.101104149527067, 1.93500743002571, 0.779285161604939, 1.81235419053557, 1.92676453082465, 1.42709928599629], [0.415797710859657, 0.234795909072275, 1.36209084536424, 0.084688396038274, 0.989923618084724, 1.17531809671753] ) ,"0.1282\t28\t",$$.' rand 3');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [0.643895385198341, 0.375880626849096, 0.261679381879866, 1.16075948164713, 0.479193183243332, 1.16199191358768], [1.44442301250506, 1.81883616376994, 0.224024331371488, 0.602250656937827, 0.637425497030073, 1.859248538621] ) ,"0.3785\t12\t",$$.' rand 4');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [1.15125235388664, 1.47171864820385, 1.31712986199715, 0.469665427341724, 1.55830995367479, 0.814466216560902], [0.225658414804251, 1.35171024871524, 0.978841048418566, 1.88968945322674, 0.0804330052698603, 1.63508218690065] ) ,"1\t18\t",$$.' rand 5');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [1.09804159092466, 0.0350909732787841, 1.57855494815711, 1.48650518399832, 0.639996845835846, 0.93391385211001], [1.70924121081361, 1.64188734487901, 1.66246519978461, 1.92522424509895, 0.848772222524893, 0.383721107823035] ) ,"0.1735\t9\t",$$.' rand 6'); 
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [0.682633838392839, 1.56833489096388, 1.33296482868337, 1.99143843344136, 1.84488535643226, 0.31985233647822], [1.92628211844086, 1.52148342108883, 0.0633322019331004, 0.595168427743516, 1.98472072414199, 1.31885530153055] ) ,"0.8102\t20\t",$$.' rand 7');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [0.518813416063274, 0.886004516048786, 0.198216349526795, 0.0966358019856131, 0.00947104319849501, 0.243808049489161], [0.060370356445155, 1.19962455984835, 1.04944747476345, 0.0985988899740278, 1.01796485164171, 1.02899269937525] ) ,"0.1735\t9\t",$$.' rand 8');
is_deeply( $correlatingData->_calculate_wilcox_statistics ( [0.0414354811470972, 1.8787199340243, 1.37539149104918, 1.06440600642689, 0.731785403280249, 1.57456654984054], [1.15141078396905, 0.777193464967027, 0.0638945443111325, 1.62570509751808, 1.29547465852288, 1.5629223804472] ) ,"1\t18\t",$$.' rand 9');
## effectifity test
#for ( my $i =  0; $i < 1000; $i ++){
#	$correlatingData->_calculate_wilcox_statistics ( [0.0414354811470972, 1.8787199340243, 1.37539149104918, 1.06440600642689, 0.731785403280249, 1.57456654984054], [1.15141078396905, 0.777193464967027, 0.0638945443111325, 1.62570509751808, 1.29547465852288, 1.5629223804472] );
#}
#print $$."start = $start; end = ".root->time()."\n";
$correlatingData = undef;

is_deeply( -d "/tmp_space/Statistics-R_$$/", undef, "the temp folder was deleted");

$correlatingData = chi_square->new();
$value = $correlatingData -> chi_square_test ( [23, 50] , [3025, 3184]);
my $exp = {
  'p_value' => '0.00499',
  'X-squared' => '7.8831',
  'df' => '1'
};

is_deeply($value, $exp,"CHI square does work #1" );

$value = $correlatingData -> chi_square_test ( [1868, 2003] , [1180, 1231]);
$exp = {
  'p_value' => '0.6148',
  'X-squared' => '0.2532',
  'df' => '1'
};
is_deeply($value, $exp,"CHI square does work #2" );

$value = $correlatingData -> chi_square_test ( [208,152] ,[2840,3082]);
$exp = {
  'p_value' => '0.0003628',
  'X-squared' => '12.7144',
  'df' => '1'
};
is_deeply($value, $exp,"CHI square does work #3" );

#print "\$exp = " . root->print_perl_var_def($value) . ";\n";
